# Automation Generator MCP Server

> MCP server that generates complete Playwright test automation projects from manual test cases

---

## Features

- **Test Case Parsing**: Parse manual test case files generated by testcase-generator-mcp
- **Project Generation**: Generate complete Playwright project structure
- **Page Objects**: Auto-generate Page Object Model classes with self-healing locators
- **Data-Driven Tests**: Create parameterized tests with JSON test data
- **AI Observer**: Integration with Claude vision for element detection
- **Configuration**: Complete TypeScript, Playwright, and package configs

---

## Installation

```bash
cd mcp-agents/automation-generator-mcp
npm install
npm run build
```

---

## Configuration

### 1. Set Environment Variables

Create `.env` file or set environment variables:

```bash
WORKSPACE_DIR=d:/Work/Claude-QE/Agents
```

### 2. Add to Claude Desktop Config

Edit your Claude Desktop config file:

**Windows**: `%APPDATA%\Claude\claude_desktop_config.json`
**Mac**: `~/Library/Application Support/Claude/claude_desktop_config.json`

Add this MCP server:

```json
{
  "mcpServers": {
    "automation-generator": {
      "command": "node",
      "args": ["d:\\Work\\Claude-QE\\Agents\\mcp-agents\\automation-generator-mcp\\dist\\index.js"],
      "env": {
        "WORKSPACE_DIR": "d:\\Work\\Claude-QE\\Agents"
      }
    }
  }
}
```

### 3. Restart Claude Desktop

---

## Usage

Once configured, you can use these tools in Claude Desktop:

### Tool 1: `generate_playwright_automation`

Generate complete Playwright project from manual test cases:

```
Please generate Playwright automation using the generate_playwright_automation tool.

Parameters:
- test_case_file: "manual-tests/MyApp_Manual_Test_Cases.txt"
- project_name: "MyApp"
```

**Optional Parameters:**
- `include_ai_observer`: `true` (default: true)
- `include_self_healing`: `true` (default: true)

### Tool 2: `parse_test_cases`

Preview/analyze test case file without generating automation:

```
Please parse the test cases using the parse_test_cases tool.

Parameters:
- test_case_file: "manual-tests/MyApp_Manual_Test_Cases.txt"
```

### Tool 3: `list_projects`

List all generated Playwright projects:

```
Please list all automation projects using the list_projects tool.
```

---

## Simple Usage Examples

### Basic Project Generation

```
I have test cases at: manual-tests/MyApp_Manual_Test_Cases.txt

Please generate a Playwright automation project for it.
```

Claude will automatically use the `generate_playwright_automation` tool!

### Preview Test Cases First

```
Before generating automation, show me what's in:
manual-tests/ShopEasy_Manual_Test_Cases.txt
```

### List Existing Projects

```
Show me all Playwright projects that have been generated.
```

---

## Output

Playwright projects are created in:
```
d:\Work\Claude-QE\Agents\playwright-projects\{ProjectName}\
```

### Project Structure:

```
playwright-projects/MyApp/
├── pages/
│   ├── BasePage.ts              # Base page with common methods
│   ├── LoginPage.ts              # Login page object
│   └── DashboardPage.ts          # Other page objects
├── tests/
│   ├── auth.spec.ts              # Authentication tests
│   └── dashboard.spec.ts         # Other test specs
├── data/
│   ├── authData.json             # Test data for auth module
│   └── dashboardData.json        # Other test data
├── utils/
│   ├── SelfHealingLocator.ts     # Self-healing locator utility
│   └── AIObserver.ts             # Claude vision integration
├── playwright.config.ts          # Playwright configuration
├── tsconfig.json                 # TypeScript configuration
├── package.json                  # Dependencies
└── README.md                     # Project documentation
```

---

## Generated Code Features

### Self-Healing Locators

Automatically generated with fallback strategies:

```typescript
// Multiple selector strategies
this.emailInput = page.locator(
  '[data-test="email"], #email, input[name="email"], input[type="email"]'
);
```

### Page Object Model

Clean, maintainable page objects:

```typescript
export class LoginPage extends BasePage {
  readonly emailInput: Locator;
  readonly passwordInput: Locator;
  readonly loginButton: Locator;

  constructor(page: Page) {
    super(page);
    this.emailInput = page.locator('[data-test="email"], #email');
    this.passwordInput = page.locator('[data-test="password"], #password');
    this.loginButton = page.locator('button:has-text("Login"), [data-test="login-btn"]');
  }

  async login(email: string, password: string): Promise<void> {
    await this.fillEmail(email);
    await this.fillPassword(password);
    await this.clickLogin();
  }

  async fillEmail(email: string): Promise<void> {
    await this.emailInput.fill(email);
  }

  async clickLogin(): Promise<void> {
    await this.loginButton.click();
  }
}
```

### Data-Driven Tests

Tests loop through JSON test data:

```typescript
test.describe('Authentication Tests', () => {
  authData.validScenarios.forEach(({ testId, email, password }) => {
    test(`${testId}: Login with valid credentials`, async ({ page }) => {
      const loginPage = new LoginPage(page);
      await loginPage.goto();
      await loginPage.login(email, password);
      await expect(page).toHaveURL(/dashboard/);
    });
  });

  authData.securityTests.forEach(({ testId, payload, category }) => {
    test(`${testId}: SQL Injection test`, async ({ page }) => {
      const loginPage = new LoginPage(page);
      await loginPage.goto();
      await loginPage.fillEmail(payload);
      await expect(loginPage.emailInput).toBeVisible();
    });
  });
});
```

### AI Observer Integration

Optional Claude vision integration for element detection:

```typescript
export class AIObserver {
  async findElement(
    screenshotBase64: string,
    elementDescription: string
  ): Promise<{ x: number; y: number; confidence: number }> {
    // Uses Claude API to locate elements visually
    const response = await anthropic.messages.create({
      model: 'claude-sonnet-4-20250514',
      messages: [{
        role: 'user',
        content: [
          { type: 'image', source: { type: 'base64', data: screenshotBase64 } },
          { type: 'text', text: `Find element: ${elementDescription}` }
        ]
      }]
    });
    return coordinates;
  }
}
```

---

## Running Generated Tests

```bash
cd playwright-projects/MyApp

# Install dependencies
npm install

# Run all tests
npm test

# Run specific test file
npx playwright test tests/auth.spec.ts

# Run with UI mode
npx playwright test --ui

# Generate test report
npx playwright show-report
```

---

## Development

### Build

```bash
npm run build
```

### Watch Mode

```bash
npm run watch
```

### Run

```bash
npm start
```

---

## Tools Reference

### `generate_playwright_automation`

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `test_case_file` | string | Yes | Path to manual test case file |
| `project_name` | string | No | Custom project name (default: extracted from file) |
| `include_ai_observer` | boolean | No | Include AI observer utility (default: true) |
| `include_self_healing` | boolean | No | Include self-healing locators (default: true) |

**Returns**: List of generated files and project path

### `parse_test_cases`

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `test_case_file` | string | Yes | Path to manual test case file |

**Returns**: Parsed structure with modules and test cases

### `list_projects`

No parameters required.

**Returns**: List of all generated Playwright projects

---

## Integration with Test Case Generator

Complete workflow:

1. **Generate Test Cases**:
```
Analyze screenshot at d:/screenshots/login.png for MyApp (https://myapp.com)
```

2. **Generate Automation**:
```
Generate Playwright automation from manual-tests/MyApp_Manual_Test_Cases.txt
```

3. **Run Tests**:
```bash
cd playwright-projects/MyApp
npm install
npm test
```

---

## Troubleshooting

### "Test case file not found"
- Check the file path is absolute and correct
- Ensure the file exists in manual-tests directory
- Verify file was generated by testcase-generator-mcp

### "Failed to parse test cases"
- Ensure test case file follows the standard format
- Check for malformed test IDs or sections
- Verify file encoding is UTF-8

### "MCP server not showing in /tools"
- Restart Claude Desktop
- Check the config file syntax is valid JSON
- Verify the path to dist/index.js is correct

### "Generated project won't build"
- Run `npm install` in the project directory
- Check Node.js version (requires 18+)
- Verify TypeScript is installed

---

## Version

**Version**: 1.0.0
**Requires**: Claude Desktop with MCP support
**Node Version**: 18+
**Playwright Version**: 1.40+

---

## License

MIT
